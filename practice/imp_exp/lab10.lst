     1                                  bits 32 ; assembling for the 32 bits architecture
     2                                  
     3                                  ; declare the EntryPoint (a label defining the very first instruction of the program)
     4                                  global start        
     5                                  
     6                                  ; declare external functions needed by our program
     7                                  extern exit, printf
     8                                  import exit msvcrt.dll
     9                                  import printf msvcrt.dll
    10                                  
    11                                  ; our data is declared here (the variables needed by our program)
    12                                  segment data use32 class=data
    13                                      ; ...
    14 00000000 4C617267657374206E-         printf_fmt db "Largest number: %d", 10, 0
    14 00000009 756D6265723A202564-
    14 00000012 0A00               
    15 00000014 050000000400000003-         numbers dd 5, 4, 3, 2, 1
    15 0000001D 000000020000000100-
    15 00000026 0000               
    16                                      NUMBERS equ ($-numbers) / 4
    17                                  
    18                                  ; our code starts here
    19                                  segment code use32 class=code
    20                                      start:
    21                                          ; max_n(numbers, numbers_len)
    22 00000000 6A05                            push NUMBERS
    23 00000002 68[14000000]                    push numbers
    24 00000007 E81A000000                      call max_n
    25 0000000C 83C408                          add esp, 2 * 4 ; eax = max
    26                                          
    27                                          
    28                                          ; printf(printf_fmt, ...)
    29 0000000F 50                              push eax
    30 00000010 68[00000000]                    push printf_fmt
    31 00000015 FF15[00000000]                  call [printf]
    32 0000001B 83C408                          add esp, 2 * 4
    33                                      
    34                                          ; exit(0)
    35 0000001E 6A00                            push    dword 0      ; push the parameter for exit onto the stack
    36 00000020 FF15[00000000]                  call    [exit]       ; call exit to terminate the program
    37                                  
    38                                        
    39                                  ; int max_n(int* numbers, int len) {...}
    40                                  ; returns the largest integer in the array
    41                                  ; or 0 if the array is empty      
    42                                  max_n:
    43                                      ; int * numbers
    44 00000026 8B542404                    mov edx, [esp + 4]
    45                                      ; int len
    46 0000002A 8B4C2408                    mov ecx, [esp + 8]
    47                                      
    48                                      ; if array is empty return 0
    49 0000002E 83F900                      cmp ecx, 0
    50 00000031 750B                        jnz while_start
    51                                      
    52 00000033 B800000000                  mov eax, 0
    53 00000038 C3                          ret
    54                                      
    55                                      ; eax = max
    56 00000039 B800000000                  mov eax, 0
    57                                      
    58                                      while_start:
    59                                          
    60 0000003E 3B048A                          cmp eax, [edx + ecx * 4]
    61                                          ; a > b ? a : b
    62 00000041 7F03                            jg while_end
    63                                          
    64 00000043 8B048A                          mov eax, [edx + ecx * 4]
    65                                              
    66                                          while_end:
    67 00000046 E2F6                                loop while_start
    68                                      
    69 00000048 C3                          ret
    70                                      
    71                                      
    72                                      
    73                                      
