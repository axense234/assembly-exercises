     1                                  bits 32 ; assembling for the 32 bits architecture
     2                                  
     3                                  ; declare the EntryPoint (a label defining the very first instruction of the program)
     4                                  global start        
     5                                  
     6                                  ; declare external functions needed by our program
     7                                  extern exit, printf, scanf
     8                                  import exit msvcrt.dll
     9                                  import printf msvcrt.dll
    10                                  import scanf msvcrt.dll
    11                                  
    12                                  ; our data is declared here (the variables needed by our program)
    13                                  segment data use32 class=data
    14 00000000 256400                      scanf_format db "%d", 0
    15 00000003 53756D206973202564-         printf_format db "Sum is %d", 10, 0
    15 0000000C 0A00               
    16 0000000E <res 0000000A>              numbers resb 10
    17 00000018 00000000                    n dd 0
    18 0000001C 00000000                    sum dd 0
    19                                  
    20                                      
    21                                  
    22                                  ; our code starts here
    23                                  segment code use32 class=code
    24                                      start:
    25                                          ; ...
    26                                          while_start:
    27 00000000 A1[18000000]                        mov eax, [n]
    28 00000005 8D0485[0E000000]                    lea eax, [numbers + eax * 4]
    29                                          
    30                                              ; eax = scanf("%d", &numbers[n])
    31                                              ; eax - nr of values read successfully
    32                                              ; ctrl+z + enter - stop inputting numbers
    33                                              ;
    34                                              ; eax, edx, ecx - not preserved
    35                                              
    36 0000000C 50                                  push eax
    37 0000000D 68[00000000]                        push scanf_format
    38 00000012 FF15[00000000]                      call [scanf]
    39 00000018 83C408                              add esp, 2 * 4
    40                                              
    41                                              ; if eax > 0
    42 0000001B 83F800                              cmp eax, 0
    43 0000001E 7E08                                jle while_end
    44                                              
    45 00000020 FF05[18000000]                      inc dword [n]
    46                                              
    47 00000026 EBD8                                jmp while_start
    48                                             
    49                                          while_end:
    50                                          
    51                                          ; for i = 1, i < n, ++i: sum += numbers[i]
    52                                          for_init:
    53 00000028 B900000000                          mov ecx, 0
    54                                          
    55                                          for_cond:
    56 0000002D 3B0D[18000000]                      cmp ecx, [n]
    57 00000033 7D10                                jge for_end
    58                                          
    59                                          for_body:
    60 00000035 8B048D[0E000000]                    mov eax, [numbers + ecx * 4]
    61 0000003C 0105[1C000000]                      add [sum], eax
    62                                          
    63                                          for_post_body:
    64 00000042 41                                  inc ecx
    65 00000043 EBE8                                jmp for_cond
    66                                              
    67                                          for_end:
    68                                          
    69                                          ; printf(printf_format, sum)
    70                                          
    71 00000045 FF35[1C000000]                  push dword [sum]
    72 0000004B 68[03000000]                    push printf_format
    73 00000050 FF15[00000000]                  call [printf]
    74 00000056 83C408                          add esp, 2 * 4
    75                                      
    76                                          ; exit(0)
    77 00000059 6A00                            push    dword 0      ; push the parameter for exit onto the stack
    78 0000005B FF15[00000000]                  call    [exit]       ; call exit to terminate the program
    79                                  
    80                                          
    81                                          
    82                                          
    83                                          
