     1                                  bits 32 ; assembling for the 32 bits architecture
     2                                  
     3                                  ; declare the EntryPoint (a label defining the very first instruction of the program)
     4                                  global start        
     5                                  
     6                                  ; declare external functions needed by our program
     7                                  extern exit               ; tell nasm that exit exists even if we won't be defining it
     8                                  import exit msvcrt.dll    ; exit is a function that ends the calling process. It is defined in msvcrt.dll
     9                                                            ; msvcrt.dll contains exit, printf and all the other important C-runtime specific functions
    10                                  
    11                                  ; our data is declared here (the variables needed by our program)
    12                                  segment data use32 class=data
    13                                      ; ...
    14                                      ; a,c-byte; b-word; d-doubleword; x-qword
    15                                      ; d-(7-a*b+c)/a-6+x/2
    16 00000000 0A                          a db 10
    17 00000001 F1FF                        b dw -15
    18 00000003 E5                          c db -27
    19 00000004 23000000                    d dd 35
    20 00000008 EDFFFFFFFFFFFFFF            x dq -19
    21                                  
    22                                  ; our code starts here
    23                                  segment code use32 class=code
    24                                      start:
    25                                          ; ...
    26                                          ; a * b = -150
    27 00000000 66A1[01000000]                  mov ax, [b] ; ax = b
    28 00000006 F62D[00000000]                  imul byte [a] ; ax = a * b
    29 0000000C 6689C3                          mov bx, ax; bx = ax = a * b
    30                                          
    31                                          ; x / 2 = - 9
    32 0000000F A1[08000000]                    mov eax, [x] ; eax = low part = FFFFFFED in the registry
    33 00000014 8B15[0C000000]                  mov edx, [x+4] ; edx = high part = FFFFFFFF in the registry
    34 0000001A B902000000                      mov ecx, 2; ecx = 2
    35 0000001F F7F9                            idiv dword ecx ; edx:eax / ecs <=> x / 2 -> eax = / (-9), edx = % (-1)
    36 00000021 89C1                            mov ecx, eax ; ecx = eax = x / 2
    37                                          
    38                                          ; (7 - a*b + c) = 130
    39 00000023 A0[03000000]                    mov al, [c]; al = cx
    40 00000028 6698                            cbw; ax = cx;
    41 0000002A 66F7DB                          neg bx ; bx = - bx = (- a*b)
    42 0000002D 6683C307                        add bx, 7 ; bx = - a * b + 7
    43 00000031 6601C3                          add bx, ax ; bx = - a * b + 7 + ax = - a * b + 7 + c = 7 - a * b + c
    44                                          
    45                                          ; (7 - a*b + c) / a = 13
    46 00000034 6689D8                          mov ax, bx ; ax = bx = (7 - a * b + c)
    47 00000037 F63D[00000000]                  idiv byte [a] ; ax / a <=> (7 - a*b + c) / a) -> al = / (13), ah = %
    48                                          
    49                                          ; d-(7-a*b+c)/a-6+x/2 = 35 - 13 - 6 + (-9) = 35 - 28 = 7
    50 0000003D 6698                            cbw ; ax = al = 13
    51 0000003F 98                              cwde ; eax = ax = 13
    52 00000040 F7D8                            neg eax; eax = - eax = -(7-a*b+c)/a
    53 00000042 0305[04000000]                  add eax, [d] ; eax = -(7-a*b+c)/a + d
    54 00000048 83E806                          sub eax, 6 ; eax = -(7-a*b+c)/a + d - 6
    55 0000004B 01C8                            add eax, ecx; eax = -(7-a*b+c)/a + d - 6 + x / 2
    56                                          ; -(7-a*b+c)/a + d - 6 + x / 2 = d-(7-a*b+c)/a-6+x/2
    57                                          
    58                                          
    59                                          
    60                                  
    61                                          
    62                                      
    63                                          ; exit(0)
    64 0000004D 6A00                            push    dword 0      ; push the parameter for exit onto the stack
    65 0000004F FF15[00000000]                  call    [exit]       ; call exit to terminate the program
